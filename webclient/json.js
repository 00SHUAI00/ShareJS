(function(){var a=!0,b,c,d,e,f;c=window.sharejs,typeof a!="undefined"&&a!==null?f=c.types.text:f=require("./text"),e={},e.name="json",e.create=function(){return null},e.invertComponent=function(a){var b;return b={p:a.p},a.si!==void 0&&(b.sd=a.si),a.sd!==void 0&&(b.si=a.sd),a.oi!==void 0&&(b.od=a.oi),a.od!==void 0&&(b.oi=a.od),a.li!==void 0&&(b.ld=a.li),a.ld!==void 0&&(b.li=a.ld),a.na!==void 0&&(b.na=-a.na),a.lm!==void 0&&(b.lm=a.p[a.p.length-1],b.p=a.p.slice(0,a.p.length-1).concat([a.lm])),b},e.invert=e.invert=function(a){var b,c,d,f,g;f=a.slice().reverse(),g=[];for(c=0,d=f.length;c<d;c++)b=f[c],g.push(e.invertComponent(b));return g},e.checkValidOp=function(a){},d=function(a){return Object.prototype.toString.call(a)==="[object Array]"},e.checkList=function(a){if(!d(a))throw new Error("Referenced element not a list")},e.checkObj=function(a){if(a.constructor!==Object)throw new Error("Referenced element not an object (it was "+JSON.stringify(a)+")")},e.apply=e.apply=function(a,c){var d,f,g,h,i,j,k,l,m,n,o,p,q;e.checkValidOp(c),c=b(c),f={data:b(a)};try{for(i=0,o=c.length;i<o;i++){d=c[i],l=null,m=null,h=f,j="data",q=d.p;for(n=0,p=q.length;n<p;n++){k=q[n],l=h,m=j,h=h[j],j=k;if(l==null)throw new Error("Path invalid")}if(d.na!==void 0){if(typeof h[j]!="number")throw new Error("Referenced element not a number");h[j]+=d.na}else if(d.si!==void 0){if(typeof h!="string")throw new Error("Referenced element not a string (it was "+JSON.stringify(h)+")");l[m]=h.slice(0,j)+d.si+h.slice(j)}else if(d.sd!==void 0){if(typeof h!="string")throw new Error("Referenced element not a string");if(h.slice(j,j+d.sd.length)!==d.sd)throw new Error("Deleted string does not match");l[m]=h.slice(0,j)+h.slice(j+d.sd.length)}else if(d.li!==void 0&&d.ld!==void 0)e.checkList(h),h[j]=d.li;else if(d.li!==void 0)e.checkList(h),h.splice(j,0,d.li);else if(d.ld!==void 0)e.checkList(h),h.splice(j,1);else if(d.lm!==void 0)e.checkList(h),d.lm!==j&&(g=h[j],h.splice(j,1),h.splice(d.lm,0,g));else if(d.oi!==void 0)e.checkObj(h),h[j]=d.oi;else if(d.od!==void 0)e.checkObj(h),delete h[j];else throw new Error("invalid / missing instruction in op")}}catch(r){throw r}return f.data},e.pathMatches=function(a,b,c){var d,e,f;if(a.length!==b.length)return!1;for(d=0,f=a.length;d<f;d++){e=a[d];if(e!==b[d]&&(!c||d!==a.length-1))return!1}return!0},e.append=function(a,c){var d;return c=b(c),a.length!==0&&e.pathMatches(c.p,(d=a[a.length-1]).p)?d.na!==void 0&&c.na!==void 0?a[a.length-1]={p:d.p,na:d.na+c.na}:d.li!==void 0&&c.li===void 0&&c.ld===d.li?d.ld!==void 0?delete d.li:a.pop():d.od!==void 0&&d.oi===void 0&&c.oi!==void 0&&c.od===void 0?d.oi=c.oi:c.lm!==void 0&&c.p[c.p.length-1]===c.lm?null:a.push(c):a.push(c)},e.compose=e.compose=function(a,c){var d,f,g,h;e.checkValidOp(a),e.checkValidOp(c),f=b(a);for(g=0,h=c.length;g<h;g++)d=c[g],e.append(f,d);return f},e.normalize=e.normalize=function(a){var b,c,f,g,h;c=[],d(a)||(a=[a]);for(f=0,g=a.length;f<g;f++)b=a[f],(h=b.p)==null&&(b.p=[]),e.append(c,b);return c},b=function(a){return JSON.parse(JSON.stringify(a))},e.commonPath=function(a,b){var c;a=a.slice(),b=b.slice(),a.unshift("data"),b.unshift("data"),a=a.slice(0,a.length-1),b=b.slice(0,b.length-1);if(b.length===0)return-1;c=0;while(a[c]===b[c]&&c<a.length){c++;if(c===b.length)return c-1}},e.transformComponent=function(a,c,d,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;c=b(c),c.na!==void 0&&c.p.push(0),d.na!==void 0&&d.p.push(0),h=e.commonPath(c.p,d.p),i=e.commonPath(d.p,c.p),l=c.p.length,p=d.p.length,c.na!==void 0&&c.p.pop(),d.na!==void 0&&d.p.pop();if(d.na)return i!=null&&p>=l&&d.p[i]===c.p[i]&&(c.ld!==void 0?(o=b(d),o.p=o.p.slice(l),c.ld=e.apply(b(c.ld),[o])):c.od!==void 0&&(o=b(d),o.p=o.p.slice(l),c.od=e.apply(b(c.od),[o]))),e.append(a,c),a;i!=null&&p>l&&c.p[i]===d.p[i]&&(c.ld!==void 0?(o=b(d),o.p=o.p.slice(l),c.ld=e.apply(b(c.ld),[o])):c.od!==void 0&&(o=b(d),o.p=o.p.slice(l),c.od=e.apply(b(c.od),[o])));if(h!=null){j=l===p;if(d.na===void 0)if(d.si!==void 0||d.sd!==void 0){if(c.si!==void 0||c.sd!==void 0){if(!j)throw new Error("must be a string?");k=function(a){var b;return b={p:a.p[a.p.length-1]},a.si?b.i=a.si:b.d=a.sd,b},v=k(c),w=k(d),t=[],f._tc(t,v,w,g);for(y=0,z=t.length;y<z;y++)u=t[y],n={p:c.p.slice(0,h)},n.p.push(u.p),u.i!=null&&(n.si=u.i),u.d!=null&&(n.sd=u.d),e.append(a,n);return a}}else if(d.li!==void 0&&d.ld!==void 0){if(d.p[h]===c.p[h]){if(!j)return a;if(c.ld!==void 0)if(c.li!==void 0&&g==="left")c.ld=b(d.li);else return a}}else if(d.li!==void 0)c.li!==void 0&&c.ld===void 0&&j&&c.p[h]===d.p[h]?g==="right"&&c.p[h]++:d.p[h]<=c.p[h]&&c.p[h]++,c.lm!==void 0&&j&&d.p[h]<=c.lm&&c.lm++;else if(d.ld!==void 0){if(c.lm!==void 0&&j){if(d.p[h]===c.p[h])return a;s=d.p[h],m=c.p[h],x=c.lm,(s<x||s===x&&m<x)&&c.lm--}if(d.p[h]<c.p[h])c.p[h]--;else if(d.p[h]===c.p[h]){if(p<l)return a;if(c.ld!==void 0)if(c.li!==void 0)delete c.ld;else return a}}else if(d.lm!==void 0)if(c.lm!==void 0&&l===p){m=c.p[h],x=c.lm,q=d.p[h],r=d.lm;if(q!==r)if(m===q)if(g==="left")c.p[h]=r,m===x&&(c.lm=r);else return a;else m>q&&c.p[h]--,m>r?c.p[h]++:m===r&&q>r&&(c.p[h]++,m===x&&c.lm++),x>q?c.lm--:x===q&&x>m&&c.lm--,x>r?c.lm++:x===r&&(r>q&&x>m||r<q&&x<m?g==="right"&&c.lm++:x>m?c.lm++:x===q&&c.lm--)}else c.li!==void 0&&c.ld===void 0&&j?(m=d.p[h],x=d.lm,s=c.p[h],s>m&&c.p[h]--,s>x&&c.p[h]++):(m=d.p[h],x=d.lm,s=c.p[h],s===m?c.p[h]=x:(s>m&&c.p[h]--,s>x?c.p[h]++:s===x&&m>x&&c.p[h]++));else if(d.oi!==void 0&&d.od!==void 0){if(c.p[h]===d.p[h]){if(c.oi===void 0||!j)return a;if(g==="right")return a;c.od=d.oi}}else if(d.oi!==void 0){if(c.oi!==void 0&&c.p[h]===d.p[h])if(g==="left")e.append(a,{p:c.p,od:d.oi});else return a}else if(d.od!==void 0&&c.p[h]===d.p[h]){if(!j)return a;if(c.oi!==void 0)delete c.od;else return a}}return e.append(a,c),a},typeof a!="undefined"&&a!==null?(c.types||(c.types={}),c._bt(e,e.transformComponent,e.checkValidOp,e.append),c.types.json=e):(module.exports=e,require("./helpers").bootstrapTransform(e,e.transformComponent,e.checkValidOp,e.append))}).call(this)