(function(){var a=!0,b,c,d,e,f,g,h,i,j,k;g=window.sharejs,k={name:"text-tp2",tp2:!0,create:function(){return{charLength:0,totalLength:0,positionCache:[],data:[]}},serialize:function(a){if(!a.data)throw new Error("invalid doc snapshot");return a.data},deserialize:function(a){var b,c,d,e;c=k.create(),c.data=a;for(d=0,e=a.length;d<e;d++)b=a[d],typeof b=="string"?(c.charLength+=b.length,c.totalLength+=b.length):c.totalLength+=b;return c}},e=function(a){var b,c,d,e,f;if(!Array.isArray(a))throw new Error("Op must be an array of components");c=null,f=[];for(d=0,e=a.length;d<e;d++){b=a[d];if(typeof b=="object")if(b.i!==void 0){if(!(typeof b.i=="string"&&b.i.length>0||typeof b.i=="number"&&b.i>0))throw new Error("Inserts must insert a string or a +ive number")}else{if(b.d===void 0)throw new Error("Operation component must define .i or .d");if(!(typeof b.d=="number"&&b.d>0))throw new Error("Deletes must be a +ive number")}else{if(typeof b!="number")throw new Error("Op components must be objects or numbers");if(!(b>0))throw new Error("Skip components must be a positive number");if(typeof c=="number")throw new Error("Adjacent skip components should be combined")}f.push(c=b)}return f},k._takeDoc=i=function(a,b,c,d){var e,f,g;if(b.index>=a.data.length)throw new Error("Operation goes past the end of the document");return e=a.data[b.index],f=typeof e=="string"?c!==void 0?e.slice(b.offset,b.offset+c):e.slice(b.offset):c===void 0||d?e-b.offset:Math.min(c,e-b.offset),g=f.length||f,(e.length||e)-b.offset>g?b.offset+=g:(b.index++,b.offset=0),f},k._appendDoc=c=function(a,b){var c;if(b===0||b==="")return;typeof b=="string"?(a.charLength+=b.length,a.totalLength+=b.length):a.totalLength+=b,c=a.data,c.length===0?c.push(b):typeof c[c.length-1]==typeof b?c[c.length-1]+=b:c.push(b)},k.apply=function(a,b){var d,f,g,h,j,l,m;if(a.totalLength===void 0||a.charLength===void 0||a.data.length===void 0)throw new Error("Snapshot is invalid");e(b),f=k.create(),h={index:0,offset:0};for(l=0,m=b.length;l<m;l++){d=b[l];if(typeof d=="number"){j=d;while(j>0)g=i(a,h,j),c(f,g),j-=g.length||g}else if(d.i!==void 0)c(f,d.i);else if(d.d!==void 0){j=d.d;while(j>0)g=i(a,h,j),j-=g.length||g;c(f,d.d)}}return f},k._append=b=function(a,b){var c;if(b!==0&&b.i!==""&&b.i!==0&&b.d!==0)return a.length===0?a.push(b):(c=a[a.length-1],typeof b=="number"&&typeof c=="number"?a[a.length-1]+=b:b.i!==void 0&&c.i!=null&&typeof c.i==typeof b.i?c.i+=b.i:b.d!==void 0&&c.d!=null?c.d+=b.d:a.push(b))},h=function(a){var b,c,d,e;return b=0,c=0,e=function(d,e){var f,g,h,i;return b===a.length?null:(h=a[b],typeof (g=h)=="number"||typeof (g=h.i)=="number"||(g=h.d)!==void 0?(d==null||g-c<=d||e&&h.i!==void 0?(f=g-c,++b,c=0):(c+=d,f=d),h.i!==void 0?{i:f}:h.d!==void 0?{d:f}:f):(d==null||h.i.length-c<=d||e?(i={i:h.i.slice(c)},++b,c=0):(i={i:h.i.slice(c,c+d)},c+=d),i))},d=function(){return a[b]},[e,d]},f=function(a){return typeof a=="number"?a:typeof a.i=="string"?a.i.length:a.d||a.i},k.normalize=function(a){var c,d,e,f;d=[];for(e=0,f=a.length;e<f;e++)c=a[e],b(d,c);return d},j=function(a,c,d,g){var i,j,k,l,m,n,o,p,q,r;e(a),e(c),l=[],q=h(a),n=q[0],m=q[1];for(o=0,p=c.length;o<p;o++){j=c[o],k=f(j);if(j.i!==void 0)if(d){if(g==="left")while(((r=m())!=null?r.i:void 0)!==void 0)b(l,n());b(l,k)}else while(k>0){i=n(k,!0);if(i===null)throw new Error("The transformed op is invalid");if(i.d!==void 0)throw new Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");typeof i=="number"?k-=i:b(l,i)}else while(k>0){i=n(k,!0);if(i===null)throw new Error("The op traverses more elements than the document has");b(l,i),i.i||(k-=f(i))}}while(j=n()){if(j.i===void 0)throw new Error("Remaining fragments in the op: "+j);b(l,j)}return l},k.transform=function(a,b,c){if(c!=="left"&&c!=="right")throw new Error("side ("+c+") should be 'left' or 'right'");return j(a,b,!0,c)},k.prune=function(a,b){return j(a,b,!1)},k.compose=function(a,c){var d,g,i,j,k,l,m,n,o,p;if(a===null||a===void 0)return c;e(a),e(c),k=[],p=h(a),l=p[0],m=p[1];for(n=0,o=c.length;n<o;n++){i=c[n];if(typeof i=="number"){j=i;while(j>0){d=l(j);if(d===null)throw new Error("The op traverses more elements than the document has");b(k,d),j-=f(d)}}else if(i.i!==void 0)b(k,{i:i.i});else{j=i.d;while(j>0){d=l(j);if(d===null)throw new Error("The op traverses more elements than the document has");g=f(d),d.i!==void 0?b(k,{i:g}):b(k,{d:g}),j-=g}}}while(i=l()){if(i.i===void 0)throw new Error("Remaining fragments in op1: "+i);b(k,i)}return k},typeof a!="undefined"&&a!==null?g.types["text-tp2"]=k:module.exports=k,typeof a!="undefined"&&a!==null?k=g.types["text-tp2"]:k=require("./text-tp2"),i=k._takeDoc,b=k._append,d=function(a,c,d,e){var f,g;g=[];while((e===void 0||e>0)&&d.index<c.data.length)f=i(c,d,e,!0),e!==void 0&&typeof f=="string"&&(e-=f.length),g.push(b(a,f.length||f));return g},k.api={provides:{text:!0},getLength:function(){return this.snapshot.charLength},getText:function(){var a,b;return b=function(){var b,c,d,e;d=this.snapshot.data,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],typeof a=="string"&&e.push(a);return e}.call(this),b.join("")},insert:function(a,c,e){var f,g;return c===void 0&&(c=0),g=[],f={index:0,offset:0},d(g,this.snapshot,f,c),b(g,{i:a}),d(g,this.snapshot,f),this.submitOp(g,e),g},del:function(a,c,e){var f,g,h;g=[],f={index:0,offset:0},d(g,this.snapshot,f,c);while(a>0)h=i(this.snapshot,f,a,!0),typeof h=="string"?(b(g,{d:h.length}),a-=h.length):b(g,h);return d(g,this.snapshot,f),this.submitOp(g,e),g},_register:function(){return this.on("remoteop",function(a,b){var c,d,e,f,g,h,j;g=0,d={index:0,offset:0};for(h=0,j=a.length;h<j;h++){c=a[h];if(typeof c=="number"){f=c;while(f>0)e=i(b,d,f),typeof e=="string"&&(g+=e.length),f-=e.length||e}else if(c.i!==void 0)typeof c.i=="string"&&(this.emit("insert",c.i,g),g+=c.i.length);else{f=c.d;while(f>0)e=i(b,d,f),typeof e=="string"&&this.emit("delete",e,g),f-=e.length||e}}})}}}).call(this)