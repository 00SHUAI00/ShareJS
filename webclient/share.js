/*
 ShareJS v0.3.0
 http://sharejs.org

 Copyright 2011 ShareJS Authors

 BSD licensed:
 https://github.com/josephg/ShareJS/raw/master/LICENSE
*/
function g(q){throw q;}var h=void 0,o=null;
(function(){function q(c,a){return function(){return c.apply(a,arguments)}}var z,A,v,u,F,I,w,p,y,r,J,K,L,G,i,M,H,B,k,N,C,D,O=Array.prototype.slice;r={};M=function(c){setTimeout(c,0)};v=function(){function c(){}c.prototype.f=function(a,b){var c;this.c||(this.c={});(c=this.c)[a]||(c[a]=[]);this.c[a].push(b);return this};c.prototype.q=function(a,b){var c,d;this.c||(this.c={});d=(c=this.c)[a]||(c[a]=[]);for(c=0;c<d.length;)d[c]===b&&(d[c]=h),c++;M(q(function(){var b;return this.c[a]=function(){var c,
e,d,n;d=this.c[a];n=[];for(c=0,e=d.length;c<e;c++)(b=d[c])&&n.push(b);return n}.call(this)},this));return this};c.prototype.a=function(){var a,b,c,d,f;b=arguments[0];a=2<=arguments.length?O.call(arguments,1):[];if(!((c=this.c)!=o&&c[b]))return this;f=this.c[b];for(c=0,d=f.length;c<d;c++)(b=f[c])&&b.apply(this,a);return this};return c}();v.w=function(c){c=c.prototype||c;c.f=c.on=v.prototype.f;c.q=c.removeListener=v.prototype.q;c.a=v.prototype.a};if(typeof module!=="undefined"&&module!==o&&module.J)module.J=
v;F=function(c,a,b,e){var d,f;d=function(b,c,e,d){a(e,b,c,"left");a(d,c,b,"right")};c.T=c.transformX=f=function(a,c){var l,n,i,k,s,x,t,E,q,p;b(a);b(c);k=[];for(x=0,E=c.length;x<E;x++){n=c[x];i=[];for(l=0;l<a.length;)if(s=[],d(a[l],n,i,s),l++,s.length===1)n=s[0];else{if(s.length===0){t=a.slice(l);for(s=0,n=t.length;s<n;s++)l=t[s],e(i,l)}else{p=f(a.slice(l),s);n=p[0];s=p[1];for(t=0,q=n.length;t<q;t++)l=n[t],e(i,l);for(n=0,t=s.length;n<t;n++)l=s[n],e(k,l)}n=o;break}n!=o&&e(k,n);a=i}return[a,k]};c.transform=
c.transform=function(b,c,e){var d,i;e==="left"||e==="right"||g(Error("type must be 'left' or 'right'"));if(c.length===0)return b;return b.length===1&&c.length===1?a([],b[0],c[0],e):e==="left"?(i=f(b,c),d=i[0],d):(d=f(c,b),i=d[1],i)}};k={name:"text"};k.create=k.create=function(){return""};B=function(c,a,b){return c.slice(0,a)+b+c.slice(a)};I=function(c){typeof c.p!=="number"&&g(Error("component missing position field"));typeof c.i==="string"^typeof c.d==="string"||g(Error("component needs an i or d field"));
c.p>=0||g(Error("position cannot be negative"))};w=function(c){var a,b,e;for(b=0,e=c.length;b<e;b++)a=c[b],I(a);return!0};k.apply=function(c,a){var b,e,d,f;w(a);for(d=0,f=a.length;d<f;d++)b=a[d],b.i!=o?c=B(c,b.p,b.i):(e=c.slice(b.p,b.p+b.d.length),b.d!==e&&g(Error("Delete component '"+b.d+"' does not match deleted text '"+e+"'")),c=c.slice(0,b.p)+c.slice(b.p+b.d.length));return c};k.U=u=function(c,a){var b,e,d;if(!(a.i===""||a.d===""))return c.length===0?c.push(a):(b=c[c.length-1],b.i!=o&&a.i!=o&&
b.p<=(e=a.p)&&e<=b.p+b.i.length?c[c.length-1]={i:B(b.i,a.p-b.p,a.i),p:b.p}:b.d!=o&&a.d!=o&&a.p<=(d=b.p)&&d<=a.p+a.d.length?c[c.length-1]={d:B(a.d,b.p-a.p,b.d),p:a.p}:c.push(a))};k.compose=k.k=function(c,a){var b,e,d,f;w(c);w(a);e=c.slice();for(d=0,f=a.length;d<f;d++)b=a[d],u(e,b);return e};k.compress=k.W=function(c){return k.k([],c)};k.normalize=function(c){var a,b,e,d;b=[];if(c.i!=o||c.p!=o)c=[c];for(e=0,d=c.length;e<d;e++)a=c[e],a.p==o&&(a.p=0),u(b,a);return b};C=function(c,a,b){return a.i!=o?a.p<
c||a.p===c&&b?c+a.i.length:c:c<=a.p?c:c<=a.p+a.d.length?a.p:c-a.d.length};k.transformCursor=function(c,a,b){var e,d,f;for(d=0,f=a.length;d<f;d++)e=a[d],c=C(c,e,b);return c};k.F=N=function(c,a,b,e){var d,f;w([a]);w([b]);if(a.i!=o)u(c,{i:a.i,p:C(a.p,b,e==="right")});else if(b.i!=o)e=a.d,a.p<b.p&&(u(c,{d:e.slice(0,b.p-a.p),p:a.p}),e=e.slice(b.p-a.p)),e!==""&&u(c,{d:e,p:a.p+b.i.length});else if(a.p>=b.p+b.d.length)u(c,{d:a.d,p:a.p-b.d.length});else if(a.p+a.d.length<=b.p)u(c,a);else if(e={d:"",p:a.p},
a.p<b.p&&(e.d=a.d.slice(0,b.p-a.p)),a.p+a.d.length>b.p+b.d.length&&(e.d+=a.d.slice(b.p+b.d.length-a.p)),f=Math.max(a.p,b.p),d=Math.min(a.p+a.d.length,b.p+b.d.length),a=a.d.slice(f-a.p,d-a.p),d=b.d.slice(f-b.p,d-b.p),a!==d&&g(Error("Delete ops delete different text in the same region of the document")),e.d!=="")e.p=C(e.p,b),u(c,e);return c};K=function(c){return c.i!=o?{d:c.i,p:c.p}:{i:c.d,p:c.p}};k.N=k.invert=function(c){var a,b,e,d;e=c.slice().reverse();d=[];for(a=0,b=e.length;a<b;a++)c=e[a],d.push(K(c));
return d};r.types||(r.types={});F(k,N,w,u);r.types.text=k;k.b={z:{text:!0},K:function(){return this.g.length},L:function(){return this.g},M:function(c,a,b){a==o&&(a=0);c=[{p:a,i:c}];this.B(c,b);return c},H:function(c,a,b){c=[{p:a,d:this.g.slice(a,a+c)}];this.B(c,b);return c},D:function(){return this.f("remoteop",function(c){var a,b,e,d;d=[];for(b=0,e=c.length;b<e;b++)a=c[b],d.push(a.i!==h?this.a("insert",a.i,a.p):this.a("delete",a.d,a.p));return d})}};k.b.provides=k.b.z;k.b.getLength=k.b.K;k.b.getText=
k.b.L;k.b.insert=k.b.M;k.b.del=k.b.H;i={name:"json",create:function(){return o},O:function(c){var a;a={p:c.p};c.si!==h&&(a.sd=c.si);c.sd!==h&&(a.si=c.sd);c.oi!==h&&(a.od=c.oi);c.od!==h&&(a.oi=c.od);c.li!==h&&(a.ld=c.li);c.ld!==h&&(a.li=c.ld);c.na!==h&&(a.na=-c.na);if(c.lm!==h)a.lm=c.p[c.p.length-1],a.p=c.p.slice(0,c.p.length-1).concat([c.lm]);return a}};i.N=function(c){var a,b,e,d;e=c.slice().reverse();d=[];for(a=0,b=e.length;a<b;a++)c=e[a],d.push(i.O(c));return d};i.G=function(){};G=function(c){return Object.prototype.toString.call(c)===
"[object Array]"};i.j=function(c){G(c)||g(Error("Referenced element not a list"))};i.s=function(c){c.constructor!==Object&&g(Error("Referenced element not an object (it was "+JSON.stringify(c)+")"))};i.apply=i.apply=function(c,a){var b,e,d,f,m,j,l,n,k,q,s,x,t,a=p(a);e={data:p(c)};try{for(m=0,s=a.length;m<s;m++){b=a[m];k=n=o;f=e;j="data";t=b.p;for(q=0,x=t.length;q<x;q++)l=t[q],n=f,k=j,f=f[j],j=l,n==o&&g(Error("Path invalid"));b.na!==h?(typeof f[j]!=="number"&&g(Error("Referenced element not a number")),
f[j]+=b.na):b.si!==h?(typeof f!=="string"&&g(Error("Referenced element not a string (it was "+JSON.stringify(f)+")")),n[k]=f.slice(0,j)+b.si+f.slice(j)):b.sd!==h?(typeof f!=="string"&&g(Error("Referenced element not a string")),f.slice(j,j+b.sd.length)!==b.sd&&g(Error("Deleted string does not match")),n[k]=f.slice(0,j)+f.slice(j+b.sd.length)):b.li!==h&&b.ld!==h?(i.j(f),f[j]=b.li):b.li!==h?(i.j(f),f.splice(j,0,b.li)):b.ld!==h?(i.j(f),f.splice(j,1)):b.lm!==h?(i.j(f),b.lm!==j&&(d=f[j],f.splice(j,1),
f.splice(b.lm,0,d))):b.oi!==h?(i.s(f),f[j]=b.oi):b.od!==h?(i.s(f),delete f[j]):g(Error("invalid / missing instruction in op"))}}catch(E){g(E)}return e.data};i.R=function(c,a){var b,e,d;if(c.length!==a.length)return!1;for(b=0,d=c.length;b<d;b++)if(e=c[b],e!==a[b])return!1;return!0};i.append=function(c,a){var b,a=p(a);return c.length!==0&&i.R(a.p,(b=c[c.length-1]).p)?b.na!==h&&a.na!==h?c[c.length-1]={p:b.p,na:b.na+a.na}:b.li!==h&&a.li===h&&a.ld===b.li?b.ld!==h?delete b.li:c.pop():b.od!==h&&b.oi===h&&
a.oi!==h&&a.od===h?b.oi=a.oi:a.lm!==h&&a.p[a.p.length-1]===a.lm?o:c.push(a):c.push(a)};i.compose=i.k=function(c,a){var b,e,d,f;e=p(c);for(d=0,f=a.length;d<f;d++)b=a[d],i.append(e,b);return e};i.normalize=function(c){var a,b,e,d;b=[];G(c)||(c=[c]);for(e=0,d=c.length;e<d;e++)a=c[e],a.p==o&&(a.p=[]),i.append(b,a);return b};p=function(c){return JSON.parse(JSON.stringify(c))};i.t=function(c,a){var b,c=c.slice(),a=a.slice();c.unshift("data");a.unshift("data");c=c.slice(0,c.length-1);a=a.slice(0,a.length-
1);if(a.length===0)return-1;for(b=0;c[b]===a[b]&&b<c.length;)if(b++,b===a.length)return b-1};i.S=function(c,a,b,e){var d,f,m,j,l,a=p(a);a.na!==h&&a.p.push(0);b.na!==h&&b.p.push(0);d=i.t(a.p,b.p);f=i.t(b.p,a.p);m=a.p.length;j=b.p.length;a.na!==h&&a.p.pop();b.na!==h&&b.p.pop();if(b.na){if(f!=o&&j>=m&&b.p[f]===a.p[f])if(a.ld!==h)f=p(b),f.p=f.p.slice(m),a.ld=i.apply(p(a.ld),[f]);else if(a.od!==h)f=p(b),f.p=f.p.slice(m),a.od=i.apply(p(a.od),[f]);i.append(c,a);return c}if(f!=o&&j>m&&a.p[f]===b.p[f])if(a.ld!==
h)f=p(b),f.p=f.p.slice(m),a.ld=i.apply(p(a.ld),[f]);else if(a.od!==h)f=p(b),f.p=f.p.slice(m),a.od=i.apply(p(a.od),[f]);if(d!=o&&(f=m===j,b.na===h))if(b.si!==h||b.sd!==h){if(a.si!==h||a.sd!==h){f||g(Error("must be a string?"));m=a.p[m-1];f=b.p[j-1];j={p:m};m={p:f};a.si!=o&&(j.i=a.si);a.sd!=o&&(j.d=a.sd);b.si!=o&&(m.i=b.si);b.sd!=o&&(m.d=b.sd);b=[];k.F(b,j,m,e);for(m=0,f=b.length;m<f;m++)j=b[m],e={p:a.p.slice(0,d)},e.p.push(j.p),j.i!=o&&(e.si=j.i),j.d!=o&&(e.sd=j.d),i.append(c,e);return c}}else if(b.li!==
h&&b.ld!==h){if(b.p[d]===a.p[d])if(f){if(a.ld!==h)if(a.li!==h&&e==="left")a.ld=p(b.li);else return c}else return c}else if(b.li!==h)a.li!==h&&a.ld===h&&f&&a.p[d]===b.p[d]?e==="right"&&a.p[d]++:b.p[d]<=a.p[d]&&a.p[d]++,a.lm!==h&&f&&b.p[d]<=a.lm&&a.lm++;else if(b.ld!==h){if(a.lm!==h&&f){if(b.p[d]===a.p[d])return c;e=b.p[d];f=a.p[d];l=a.lm;(e<l||e===l&&f<l)&&a.lm--}if(b.p[d]<a.p[d])a.p[d]--;else if(b.p[d]===a.p[d])if(j<m)return c;else if(a.ld!==h)if(a.li!==h)delete a.ld;else return c}else if(b.lm!==
h)if(a.lm!==h&&m===j){if(f=a.p[d],l=a.lm,j=b.p[d],b=b.lm,j!==b)if(f===j)if(e==="left")a.p[d]=b,f===l&&(a.lm=b);else return c;else f>j&&a.p[d]--,f>b?a.p[d]++:f===b&&j>b&&(a.p[d]++,f===l&&a.lm++),l>j?a.lm--:l===j&&l>f&&a.lm--,l>b?a.lm++:l===b&&(b>j&&l>f||b<j&&l<f?e==="right"&&a.lm++:l>f?a.lm++:l===j&&a.lm--)}else a.li!==h&&a.ld===h&&f?(f=b.p[d],l=b.lm,e=a.p[d],e>f&&a.p[d]--,e>l&&a.p[d]++):(f=b.p[d],l=b.lm,e=a.p[d],e===f?a.p[d]=l:(e>f&&a.p[d]--,e>l?a.p[d]++:e===l&&f>l&&a.p[d]++));else if(b.oi!==h&&b.od!==
h){if(a.p[d]===b.p[d])if(a.oi!==h&&f)if(e==="right")return c;else a.od=b.oi;else return c}else if(b.oi!==h){if(a.oi!==h&&a.p[d]===b.p[d])if(e==="left")i.append(c,{p:a.p,od:b.oi});else return c}else if(b.od!==h&&a.p[d]===b.p[d]){if(!f)return c;if(a.oi!==h)delete a.od;else return c}i.append(c,a);return c};r.types||(r.types={});F(i,i.S,i.G,i.append);r.types.json=i;D||(D=r.types);window.io||g(Error("Must load socket.io before this library"));L=window.io;A=function(c,a,b,e,d){var f,i,j,l,k,p,r;this.name=
a;this.version=b;this.type=e;this.type.k==o&&g(Error("Handling types without compose() defined is not currently implemented"));this.r=function(a){this.snapshot=this.g=a};this.r(d);i=o;f=[];k=o;l=[];p={};r=q(function(){if(i===o&&k!==o)return i=k,f=l,k=o,l=[],c.send({doc:this.name,op:i,v:this.version},q(function(a){var b,c,e;if(a.v===o){for(c=0,e=f.length;c<e;c++)b=f[c],b(o);i=o;g(Error(a.error))}a.v!==this.version&&g(Error("Invalid version from server"));p[this.version]=i;this.version++;for(a=0,c=
f.length;a<c;a++)b=f[a],b(i,o);i=o;return r()},this))},this);this.C=function(a){var b,c,e;if(!(a.v<this.version))return a.doc!==this.name&&g(Error("Expected docName "+this.name+" but got "+a.doc)),a.v!==this.version&&g(Error("Expected version "+this.version+" but got "+a.v)),a=a.op,p[this.version]=a,c=this.type.T||q(function(a,b){var c,e;c=this.type.transform(a,b,"left");e=this.type.transform(b,a,"right");return[c,e]},this),i!==o&&(b=c(i,a),i=b[0],a=b[1]),k!==o&&(e=c(k,a),k=e[0],a=e[1]),b=this.g,
this.r(this.type.apply(b,a)),this.version++,this.a("remoteop",a,b),this.a("change",a,b)};this.submitOp=this.B=function(a,b,c){var e;if(b==o)b=this.version;if(typeof b==="function")c=b,b=this.version;if(((e=this.type)!=o?e.normalize:h)!=o)a=this.type.normalize(a);for(;b<this.version;)(e=p[b])||g(Error("Op version too old")),a=this.type.transform(a,e,"left"),b++;this.r(this.type.apply(this.g,a));k=k!==o?this.type.k(k,a):a;c&&l.push(c);this.a("change",a);return setTimeout(r,0)};this.close=this.close=
function(a){return c.send({doc:this.name,open:!1},q(function(){a&&a();this.a("closed")},this))};if(this.type.b){b=this.type.b;for(j in b)a=b[j],this[j]=a;this.D()}else this.z=this.provides={};return this};v.w(A);z=function(){function c(a,b,c){this.o=q(this.o,this);this.l=q(this.l,this);this.m=q(this.m,this);this.h=new L.Socket(a,{port:b,X:c?path+"/socket.io":"socket.io"});this.h.on("connect",this.l);this.h.on("disconnect",this.m);this.h.on("message",this.o);this.h.connect();this.e={};this.n=0}c.prototype.m=
function(){return this.a("disconnect")};c.prototype.l=function(){return this.a("connect")};c.prototype.send=function(a,b){var c,d;c=a.doc;c===this.Q?delete a.doc:this.Q=c;this.h.send(a);if(b)return d=q(function(a){var d;d=q(function(i){if(i.doc===c)return this.q(a,d),b(i)},this);return this.f(a,d)},this),d(a.open===!0?"open":a.open===!1?"close":a.create?"create":a.snapshot===o?"snapshot":a.op?"op response":h)};c.prototype.o=function(a){var b,c;b=a.doc;b!==h?this.P=b:a.doc=b=this.P;this.a("message",
a);c=a.open===!0||a.open===!1&&a.error?"open":a.open===!1?"close":a.snapshot!==h?"snapshot":a.create?"create":a.op?"op":a.v!==h?"op response":h;this.a(c,a);if(c==="op"&&(b=this.e[b]))return b.C(a)};c.prototype.u=function(a){var b,c;c=a.doc;this.e[c]&&g(Error("Document "+c+" already followed"));b=a.type;typeof b==="string"&&(b=D[b]);b=new A(this,c,a.v,b,a.snapshot);b.created=!!a.create;this.e[c]=b;this.n++;b.f("closed",q(function(){delete this.e[c];return this.n--},this));return b};c.prototype.openExisting=
function(a,b){return this.e[a]!=o?this.e[a]:this.send({doc:a,open:!0,snapshot:o},q(function(a){return a.error?b(o,Error(a.error)):b(this.u(a))},this))};c.prototype.open=function(a,b,c){typeof b==="function"&&(c=b,b="text");c||(c=function(){});typeof b==="string"&&(b=D[b]);if(a!=o&&this.e[a]!=o)a=this.e[a],a.type===b?c(a):c(a,"Type mismatch");else return this.send({doc:a,open:!0,create:!0,snapshot:o,type:b.name},q(function(a){return a.error?c(o,a.error):(a.snapshot===h&&(a.snapshot=b.create()),a.type=
b,c(this.u(a)))},this))};c.prototype.create=function(a,b){return H(o,a,b)};c.prototype.disconnect=function(){if(this.A!=o)return this.a("disconnected"),this.A.I(),this.A=o};return c}();v.w(z);y={};J=function(c,a,b){var e;if(c==o)c=window.location.hostname;if(a==o)a=window.location.port;e=c;a!=o&&(e+=":"+a);y[e]||(c=new z(c,a,b),c.f("disconnected",function(){return delete y[e]}),y[e]=c);return y[e]};H=function(c,a,b,e){var d;typeof b==="function"&&(e=b,b=o);b==o&&(b={});d=J(b.host,b.port,b.V);return d.open(c,
a,function(a,b){return a===o?e(o,b):(a.f("closed",function(){return setTimeout(function(){if(d.n===0)return d.I()},0)}),e(a))})};r.Connection=z;r.Document=A;r.open=H;window.sharejs=r}).call(this);