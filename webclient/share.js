(function(){
/*
 ShareJS v0.4.0
 http://sharejs.org

 BSD licensed:
 https://github.com/josephg/ShareJS/raw/master/LICENSE
*/
function f(j){throw j;}var p=void 0,r=null;
(function(){function j(b,a){return function(){return b.apply(a,arguments)}}var v,x,q,o,B,G,t,u,n,H,I,C,D,y,z,h,E,A,w,L=Array.prototype.slice;n={version:"0.4.0"};D=typeof!0!=="undefined"?function(b){return setTimeout(b,0)}:D=process.nextTick;q=function(){function b(){}b.prototype.f=function(a,c){var b;this.c||(this.c={});(b=this.c)[a]||(b[a]=[]);this.c[a].push(c);return this};b.prototype.r=function(a,c){var b,e;this.c||(this.c={});e=(b=this.c)[a]||(b[a]=[]);for(b=0;b<e.length;)e[b]===c&&(e[b]=p),b++;
D(j(function(){var c;return this.c[a]=function(){var b,d,e,i;e=this.c[a];i=[];for(b=0,d=e.length;b<d;b++)(c=e[b])&&i.push(c);return i}.call(this)},this));return this};b.prototype.a=function(){var a,b,d,e,g;b=arguments[0];a=2<=arguments.length?L.call(arguments,1):[];if(!((d=this.c)!=r&&d[b]))return this;g=this.c[b];for(d=0,e=g.length;d<e;d++)(b=g[d])&&b.apply(this,a);return this};return b}();q.q=function(b){b=b.prototype||b;b.f=b.on=q.prototype.f;b.r=b.removeListener=q.prototype.r;b.a=b.emit=q.prototype.a};
if(typeof module!=="undefined"&&module!==r&&module.n)module.n=q;n._bt=B=function(b,a,c,d){var e,g;e=function(b,c,d,e){a(d,b,c,"left");a(e,c,b,"right")};b.H=b.transformX=g=function(a,b){var l,i,k,h,m,j,s,J,K,F;c(a);c(b);h=[];for(j=0,J=b.length;j<J;j++){i=b[j];k=[];for(l=0;l<a.length;)if(m=[],e(a[l],i,k,m),l++,m.length===1)i=m[0];else{if(m.length===0){s=a.slice(l);for(m=0,i=s.length;m<i;m++)l=s[m],d(k,l)}else{F=g(a.slice(l),m);i=F[0];m=F[1];for(s=0,K=i.length;s<K;s++)l=i[s],d(k,l);for(i=0,s=m.length;i<
s;i++)l=m[i],d(h,l)}i=r;break}i!=r&&d(h,i);a=k}return[a,h]};return b.transform=b.transform=function(b,c,d){var e,k;d==="left"||d==="right"||f(Error("type must be 'left' or 'right'"));if(c.length===0)return b;return b.length===1&&c.length===1?a([],b[0],c[0],d):d==="left"?(k=g(b,c),e=k[0],e):(e=g(c,b),k=e[1],k)}};if(typeof!0==="undefined")n.u=B;h={name:"text"};h.create=h.create=function(){return""};z=function(b,a,c){return b.slice(0,a)+c+b.slice(a)};G=function(b){typeof b.p!=="number"&&f(Error("component missing position field"));
typeof b.i==="string"^typeof b.d==="string"||f(Error("component needs an i or d field"));b.p>=0||f(Error("position cannot be negative"))};t=function(b){var a,c,d;for(c=0,d=b.length;c<d;c++)a=b[c],G(a);return!0};h.apply=function(b,a){var c,d,e,g;t(a);for(e=0,g=a.length;e<g;e++)c=a[e],c.i!=r?b=z(b,c.p,c.i):(d=b.slice(c.p,c.p+c.d.length),c.d!==d&&f(Error("Delete component '"+c.d+"' does not match deleted text '"+d+"'")),b=b.slice(0,c.p)+b.slice(c.p+c.d.length));return b};h.C=o=function(b,a){var c,d,
e;if(!(a.i===""||a.d===""))return b.length===0?b.push(a):(c=b[b.length-1],c.i!=r&&a.i!=r&&c.p<=(d=a.p)&&d<=c.p+c.i.length?b[b.length-1]={i:z(c.i,a.p-c.p,a.i),p:c.p}:c.d!=r&&a.d!=r&&a.p<=(e=c.p)&&e<=a.p+a.d.length?b[b.length-1]={d:z(a.d,c.p-a.p,c.d),p:a.p}:b.push(a))};h.compose=h.w=function(b,a){var c,d,e,g;t(b);t(a);d=b.slice();for(e=0,g=a.length;e<g;e++)c=a[e],o(d,c);return d};h.compress=h.D=function(b){return h.w([],b)};h.normalize=function(b){var a,c,d,e;c=[];if(b.i!=r||b.p!=r)b=[b];for(d=0,e=
b.length;d<e;d++)a=b[d],a.p==r&&(a.p=0),o(c,a);return c};A=function(b,a,c){return a.i!=r?a.p<b||a.p===b&&c?b+a.i.length:b:b<=a.p?b:b<=a.p+a.d.length?a.p:b-a.d.length};h.transformCursor=function(b,a,c){var d,e,g;for(e=0,g=a.length;e<g;e++)d=a[e],b=A(b,d,c);return b};h._tc=E=function(b,a,c,d){var e,g;t([a]);t([c]);if(a.i!=r)o(b,{i:a.i,p:A(a.p,c,d==="right")});else if(c.i!=r)d=a.d,a.p<c.p&&(o(b,{d:d.slice(0,c.p-a.p),p:a.p}),d=d.slice(c.p-a.p)),d!==""&&o(b,{d:d,p:a.p+c.i.length});else if(a.p>=c.p+c.d.length)o(b,
{d:a.d,p:a.p-c.d.length});else if(a.p+a.d.length<=c.p)o(b,a);else if(d={d:"",p:a.p},a.p<c.p&&(d.d=a.d.slice(0,c.p-a.p)),a.p+a.d.length>c.p+c.d.length&&(d.d+=a.d.slice(c.p+c.d.length-a.p)),g=Math.max(a.p,c.p),e=Math.min(a.p+a.d.length,c.p+c.d.length),a=a.d.slice(g-a.p,e-a.p),e=c.d.slice(g-c.p,e-c.p),a!==e&&f(Error("Delete ops delete different text in the same region of the document")),d.d!=="")d.p=A(d.p,c),o(b,d);return b};I=function(b){return b.i!=r?{d:b.i,p:b.p}:{i:b.d,p:b.p}};h.F=h.invert=function(b){var a,
c,d,e;d=b.slice().reverse();e=[];for(a=0,c=d.length;a<c;a++)b=d[a],e.push(I(b));return e};typeof!0!=="undefined"?(n.types||(n.types={}),B(h,E,t,o),n.types.text=h):(module.n=h,require("./helpers").u(h,E,t,o));typeof!0==="undefined"&&(h=require("./text"));h.api={provides:{text:!0},getLength:function(){return this.g.length},getText:function(){return this.g},insert:function(b,a,c){a==r&&(a=0);b=[{p:a,i:b}];this.s(b,c);return b},del:function(b,a,c){b=[{p:a,d:this.g.slice(a,a+b)}];this.s(b,c);return b},
_register:function(){return this.f("remoteop",function(b){var a,c,d,e;e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(a.i!==p?this.a("insert",a.i,a.p):this.a("delete",a.d,a.p));return e})}};typeof!0!=="undefined"?(w||(w=n.types),window.io||f(Error("Must load socket.io before this library")),C=window.io):(w=require("../types"),C=require("socket.io-client"),q=require("./microevent"));x=function(b,a,c,d,e){var g,h,n,l,i,k,o,m,q;this.name=a;this.version=c;this.type=d;this.type.compose==r&&f(Error("Handling types without compose() defined is not currently implemented"));
o=j(function(a){return this.snapshot=this.g=a},this);o(e);h=r;g=[];k=r;i=[];q=this.type.transformX||j(function(a,b){var c,d;c=this.type.transform(a,b,"left");d=this.type.transform(b,a,"right");return[c,d]},this);l=j(function(a,b){var c;c=this.g;o(this.type.apply(this.g,a));b&&this.a("remoteop",a,c);return this.a("change",a,c)},this);m=j(function(){if(h===r&&k!==r)return h=k,g=i,k=r,i=[],b.send({doc:this.name,op:h,v:this.version},j(function(a,b){var c,e,i,j;e=h;h=r;if(b){d.invert?(e=this.type.invert(e),
k&&(c=q(k,e),k=c[0],e=c[1]),l(e,!0)):f(Error("Op apply failed ("+a.error+") and the OT type does not define an invert function."));for(e=0,i=g.length;e<i;e++)c=g[e],c(r,b)}else{a.v!==this.version&&f(Error("Invalid version from server"));this.version++;for(i=0,j=g.length;i<j;i++)c=g[i],c(e,r)}return m()},this))},this);this.t=function(a){var b,c;if(!(a.v<this.version))return a.doc!==this.name&&f(Error("Expected docName '"+this.name+"' but got "+a.doc)),a.v!==this.version&&f(Error("Expected version "+
this.version+" but got "+a.v)),a=a.op,h!==r&&(b=q(h,a),h=b[0],a=b[1]),k!==r&&(c=q(k,a),k=c[0],a=c[1]),this.version++,l(a,!0)};this.submitOp=this.s=function(a,b){this.type.normalize!=r&&(a=this.type.normalize(a));o(this.type.apply(this.g,a));k=k!==r?this.type.compose(k,a):a;b&&i.push(b);this.a("change",a);return setTimeout(m,0)};this.flush=function(){return m()};this.close=this.close=function(a){return b.send({doc:this.name,open:!1},j(function(){a&&a();this.a("closed")},this))};if(this.type.api){c=
this.type.api;for(n in c)a=c[n],this[n]=a;typeof this._register==="function"&&this._register()}else this.G=this.provides={};return this};q.q(x);v=function(){function b(a){this.m=j(this.m,this);this.h=j(this.h,this);this.l=j(this.l,this);this.e={};this.k=0;this.j={};this.b=C.connect(a,{"force new connection":!0});this.b.on("connect",this.h);this.b.on("disconnect",this.l);this.b.on("message",this.m);this.b.on("connect_failed",j(function(a){var b,e,g,h,j,l,i;a==="unauthorized"&&(a="forbidden");this.b=
r;this.a("connect failed",a);l=this.j;i=[];for(g in l)h=l[g],i.push(function(){var g;g=[];for(j in h)e=h[j],g.push(function(){var g,h,i;i=[];for(g=0,h=e.length;g<h;g++)b=e[g],i.push(b(r,a));return i}());return g}());return i},this));this.b.socket.connected&&setTimeout(j(function(){return this.h()},this),0)}b.prototype.l=function(){return this.a("disconnect")};b.prototype.h=function(){return this.a("connect")};b.prototype.send=function(a,b){var d,e,g;this.b===r&&f(Error("Cannot send messages to a closed connection"));
e=a.doc;e===this.A?delete a.doc:this.A=e;this.b.json.send(a);if(b)return d=a.open===!0?"open":a.open===!1?"close":a.create?"create":a.snapshot===r?"snapshot":a.op?"op response":p,e=(g=this.j)[e]||(g[e]={}),d=e[d]||(e[d]=[]),d.push(b)};b.prototype.m=function(a){var b,d,e,g,h,j;e=a.doc;e!==p?this.z=e:a.doc=e=this.z;this.a("message",a);g=a.open===!0||a.open===!1&&a.error?"open":a.open===!1?"close":a.snapshot!==p?"snapshot":a.create?"create":a.op?"op":a.v!==p?"op response":p;if(d=(b=this.j[e])!=r?b[g]:
p){delete this.j[e][g];for(h=0,j=d.length;h<j;h++)b=d[h],b(a,a.error)}if(g==="op"&&(d=this.e[e]))return d.t(a)};b.prototype.o=function(a){var b,d;d=a.doc;this.e[d]&&f(Error("Doc "+d+" already open"));b=a.type;typeof b==="string"&&(b=w[b]);b=new x(this,d,a.v,b,a.snapshot);b.created=!!a.create;this.e[d]=b;this.k++;b.f("closed",j(function(){delete this.e[d];return this.k--},this));return b};b.prototype.openExisting=function(a,b){if(this.b===r)b(r,"connection closed");else return this.e[a]!=r?this.e[a]:
this.send({doc:a,open:!0,snapshot:r},j(function(a,e){return e?b(r,e):b(this.o(a))},this))};b.prototype.open=function(a,b,d){if(this.b===r)d(r,"connection closed");else if(typeof b==="function"&&(d=b,b="text"),d||(d=function(){}),typeof b==="string"&&(b=w[b]),b||f(Error("OT code for document type missing")),a!=r&&this.e[a]!=r)a=this.e[a],a.type===b?d(a):d(a,"Type mismatch");else return this.send({doc:a,open:!0,create:!0,snapshot:r,type:b.name},j(function(a,g){return g?d(r,g):(a.snapshot===p&&(a.snapshot=
b.create()),a.type=b,d(this.o(a)))},this))};b.prototype.create=function(a,b){return y(r,a,b)};b.prototype.disconnect=function(){if(this.b)return this.a("disconnected"),this.b.disconnect(),this.b=r};return b}();q.q(v);u={};H=function(b){var a;if(typeof!0!=="undefined")a=window.location,b==r&&(b=""+a.protocol+"//"+a.hostname+"/sjs");u[b]||(a=new v(b),a.f("disconnected",function(){return delete u[b]}),a.f("connect failed",function(){return delete u[b]}),u[b]=a);return u[b]};y=function(b,a,c,d){var e;
typeof c==="function"&&(d=c,c=r);e=H(c);e.open(b,a,function(a,b){return a===r?(e.k===0&&e.disconnect(),d(r,b)):(a.f("closed",function(){return setTimeout(function(){if(e.k===0)return e.disconnect()},0)}),d(a))});return e.f("connect failed")};typeof!0!=="undefined"?(n.Connection=v,n.Doc=x,n.open=y,window.sharejs=n):(n.B=v,n.open=y)}).call(this);})();